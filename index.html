<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ColindÄƒtori Buftea</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
body{margin:0;font-family:Arial;background:#f3f4f6;}
#map{height:70vh;width:100%;}
header{background:#dc2626;color:white;padding:1rem;text-align:center;font-size:1.5rem;font-weight:bold;}
.btn-main{position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);background:#dc2626;color:white;border:none;padding:1rem 2rem;border-radius:1rem;font-size:1.2rem;cursor:pointer;z-index:9999;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:10000;}
.modal-box{background:white;padding:1rem;border-radius:1rem;width:90%;max-width:400px;max-height:90vh;overflow-y:auto;}
.hidden{display:none;}
.custom-marker{display:inline-flex;align-items:center;justify-content:center;font-size:42px;width:48px;height:48px;background:transparent;border-radius:50%;filter:drop-shadow(0 3px 6px rgba(0,0,0,0.25));transition:transform .12s;}
.custom-marker:hover{transform:scale(1.15);}
.leaflet-tooltip.my-tooltip{background:white;color:#1f2937;border:1px solid #d1d5db;border-radius:.5rem;padding:.5rem;font-size:.9rem;box-shadow:0 3px 6px rgba(0,0,0,0.2);} 
#delete-form{position:fixed;bottom:0;left:0;right:0;background:white;padding:1rem;border-top:3px solid #dc2626;z-index:10001;border-radius:1rem 1rem 0 0;}
</style>
</head>
<body>
<header>ColindÄƒtori â€“ Cartier Tineri Buftea</header>
<div id="map"></div>
<button class="btn-main" onclick="openAddModal()">AdaugÄƒ CasÄƒ</button>

<!-- MODAL ADÄ‚UGARE -->
<div id="add-modal" class="modal hidden">
  <div class="modal-box">
    <h2>AdaugÄƒ o casÄƒ</h2>
    <label>Nume familie</label>
    <input id="name" style="width:100%;padding:.5rem;margin-bottom:.5rem;">
    <label>Strada</label>
    <input id="address" style="width:100%;padding:.5rem;margin-bottom:.5rem;">
    <label>NumÄƒr</label>
    <input id="streetNumber" style="width:100%;padding:.5rem;margin-bottom:.5rem;">
    <label>Program</label>
    <input id="schedule" style="width:100%;padding:.5rem;margin-bottom:.5rem;">
    <label>Detalii</label>
    <textarea id="notes" style="width:100%;padding:.5rem;margin-bottom:.5rem;"></textarea>
    <label>ParolÄƒ pentru È™tergere</label>
    <input id="password" type="password" style="width:100%;padding:.5rem;margin-bottom:.5rem;">
    <button onclick="submitAdd()" style="background:#dc2626;color:white;padding:.7rem 1rem;border:none;border-radius:.5rem;width:100%;margin-top:.5rem;">SalveazÄƒ</button>
    <button onclick="closeAddModal()" style="margin-top:.5rem;width:100%;">AnuleazÄƒ</button>
  </div>
</div>

<!-- MODAL VIEW -->
<div id="view-modal" class="modal hidden">
  <div class="modal-box" id="view-content"></div>
</div>

<!-- FORM È˜TERGERE -->
<div id="delete-form" class="hidden">
  <h3>È˜terge aceastÄƒ casÄƒ</h3>
  <input id="delete-password" type="password" placeholder="Parola" style="width:100%;padding:.5rem;margin-bottom:.5rem;">
  <button onclick="confirmDelete()" style="background:#dc2626;color:white;padding:.7rem 1rem;border:none;border-radius:.5rem;width:100%;">È˜terge</button>
  <button onclick="closeDeleteForm()" style="margin-top:.5rem;width:100%;">AnuleazÄƒ</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// === Firebase ===
const firebaseConfig={ apiKey:"test", databaseURL:"https://colindatori-buftea.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const database=firebase.database();

// === HARTÄ‚ ===
let map=L.map('map').setView([44.561,25.957],16);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let markers=[];
let pins=[];
let clickedLocation=null;
let selectedPin=null;

map.on('click',e=>{clickedLocation=e.latlng; alert("LocaÈ›ie selectatÄƒ!")});

database.ref('pins').on('value',snap=>{
  pins=[];
  snap.forEach(child=>{ let o=child.val(); o.id=child.key; pins.push(o); });
  updateMap();
});

function updateMap(){ markers.forEach(m=>m.remove()); markers=[];
  pins.forEach(pin=>{
    const emoji=pin.icon||'ğŸ„';
    const marker=L.marker([pin.lat,pin.lng],{
      icon:L.divIcon({ html:`<div class='custom-marker'>${emoji}</div>`, className:"" })
    }).addTo(map);

    let t=`<b>${pin.name}</b><br>${pin.address}, Nr. ${pin.streetNumber}`;
    if(pin.schedule) t+=`<br>ğŸ• ${pin.schedule}`;
    if(pin.notes) t+=`<br>${pin.notes}`;
    marker.bindTooltip(t,{className:'my-tooltip',direction:'top'});
    marker.on('click',()=>showPin(pin));
    markers.push(marker);
  });
}

// === ADÄ‚UGARE ===
function openAddModal(){document.getElementById('add-modal').classList.remove('hidden');}
function closeAddModal(){document.getElementById('add-modal').classList.add('hidden');}

function submitAdd(){
  const name=nameInput.value=document.getElementById('name').value.trim();
  const address=document.getElementById('address').value.trim();
  const streetNumber=document.getElementById('streetNumber').value.trim();
  if(!name||!address||!streetNumber){alert("CompleteazÄƒ toate cÃ¢mpurile obligatorii!"); return;}
  if(!clickedLocation){alert("ApasÄƒ pe hartÄƒ pentru a selecta locaÈ›ia!"); return;}

  database.ref('pins').push({
    name,address,streetNumber,
    schedule:document.getElementById('schedule').value,
    notes:document.getElementById('notes').value,
    icon:'ğŸ„',
    password:document.getElementById('password').value,
    lat:clickedLocation.lat,lng:clickedLocation.lng
  }).then(()=>{ closeAddModal(); alert("CasÄƒ adÄƒugatÄƒ!"); });
}

// === VIEW ===
function showPin(pin){
  selectedPin=pin;
  document.getElementById('view-content').innerHTML=`
    <h2>${pin.name}</h2>
    <p>ğŸ  ${pin.address}, Nr. ${pin.streetNumber}</p>
    ${pin.schedule?`<p>ğŸ• ${pin.schedule}</p>`:""}
    ${pin.notes?`<p>${pin.notes}</p>`:""}
    <button onclick='showDeleteForm()' style='background:#dc2626;color:white;padding:.7rem;width:100%;border:none;border-radius:.5rem;'>È˜terge</button>
    <button onclick='closeViewModal()' style='margin-top:.5rem;width:100%;'>Ãnchide</button>`;
  document.getElementById('view-modal').classList.remove('hidden');
}
function closeViewModal(){document.getElementById('view-modal').classList.add('hidden');}

// === È˜TERGERE ===
function showDeleteForm(){document.getElementById('delete-form').classList.remove('hidden');}
function closeDeleteForm(){document.getElementById('delete-form').classList.add('hidden'); document.getElementById('delete-password').value="";}

function confirmDelete(){
  const pw=document.getElementById('delete-password').value;
  if(!pw){alert("Introdu parola!"); return;}
  if(pw!==selectedPin.password){alert("ParolÄƒ greÈ™itÄƒ!"); return;}

  database.ref('pins/'+selectedPin.id).remove();
  closeDeleteForm(); closeViewModal(); alert("CasÄƒ È™tearsÄƒ!");
}
</script>
</body>
</html>
